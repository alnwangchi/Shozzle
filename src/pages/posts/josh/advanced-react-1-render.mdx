---
layout: '@layouts/BlogPostLayout.astro'
title: Basic React render mechanism
date: 2023-10-19
author: Josh Chou
image: { src: 'https://i.imgur.com/pvJcxdF.jpeg', alt: 'ç¯„ä¾‹' }
description: 'ADVANCED REACT åˆæ¢ React render çš„æ©Ÿåˆ¶'
draft: false
category: react
---

import PostImage from '@components/postComponents/PostImage.astro';

## Description

**"ADVANCED REACT"** åˆæ¢ React render çš„æ©Ÿåˆ¶

## å‰è¨€

æœ€è¿‘é–‹å§‹ç¿»äº† **"ADVANCED REACT"** é€™æœ¬æ›¸ï¼Œç™¼ç¾å¯¦åœ¨è¬›å¾—å¤ªå¥½ï¼Œå¾ˆå¤šå¯¦å‹™æ“ä½œå¯ä»¥ç›´æ¥æ‡‰ç”¨åœ¨å·¥ä½œä¸Šï¼Œæ›¸ä¸­æåˆ°å¾ˆå¤š commonly misused waysï¼Œå¯ä»¥æ‹¿ä¾†é‡æ–°å¯©è¦–è‡ªå·±å¹³å¸¸å¯«çš„(ğŸ’©?)codeã€‚
å› ç‚ºæœ¬æ›¸çš„æ›¸åå°±æ˜¯"Advanced"ï¼Œæ‰€ä»¥å¹¾ä¹æ²’æœ‰ç¯‡å¹…åœ¨ä»‹ç´¹ React å®˜ç¶²å°±æœ‰çš„ useXXX æ€éº¼ä½¿ç”¨ï¼Œè¼ƒå¤šè‘—å¢¨åœ¨ How to optimize your codeï¼Œæ¨è–¦çµ¦ç›®å‰åªæœ‰å…©æ‹› useState, useEffect èµ°å¤©ä¸‹ï¼Œå¿«è¦è¢«çœ‹ç ´æ‰‹è…³çš„åŒå­¸ã€‚

## React æ˜¯åœ¨ render ä»€éº¼?

å€Ÿç”¨æ›¸ä¸­ onScroll ç›£è½çš„ä¾‹å­ï¼Œå¦‚æœç”¨å¦‚ä¸‹æœ€ç›´è¦ºçš„å¯«æ³•ï¼Œä¸»ç®¡å¯èƒ½ä¸æœƒ approve ä½ çš„ PRï¼š

```javascript
const MainScrollableArea = () => {
  const [position, setPosition] = useState(300);

  const onScroll = (e) => {
    // calculate position based on the scrolled value
    const calculated = getPosition(e.target.scrollTop);
    // save it to state
    setPosition(calculated);
  };
  return (
    <div className="scrollable-block" onScroll={onScroll}>
      {/* pass position value to the new movable component */}
      <MovingBlock position={position} />
      <VerySlowComponent />
      <BunchOfStuff />
      <OtherStuffAlsoComplicated />
    </div>
  );
};
```

ç‚ºä»€éº¼å‘¢ï¼Ÿ
å¦‚æœæ¯ä¸€å€‹ component éƒ½é€™æ¨£å¯«ï¼Œé‚£éº¼æ¯æ¬¡ scroll éƒ½æœƒè§¸ç™¼æ‰€æœ‰ component çš„ renderï¼Œé€™æ¨£çš„æ•ˆèƒ½æ˜¯å¾ˆå·®çš„ï¼Œå› ç‚ºåªæœ‰ MovingBlock éœ€è¦æ ¹æ“š scroll çš„ä½ç½®å» renderï¼Œå…¶ä»–çš„ component éƒ½ä¸éœ€è¦ï¼Œæˆ‘å€‘è¦åšçš„æ˜¯æŠŠé€™ä¸€å¨ä¸éœ€æ›´æ–°çš„éƒ¨åˆ†ç”¨ props çš„æ–¹å¼å‚³é€²ä¾†ï¼Œå¦‚ä¸‹ï¼š

```javascript
  const ScrollableWithMovingBlock = ({ content }) => {
    const [position, setPosition] = useState(300);
    const onScroll = () => {...} // same as before
    return (
      <div className="scrollable-block" onScroll={onScroll}>
        <MovingBlock position={position} />
        {content}
      </div>
    )
  }
```

ç­‰ç­‰ï¼Œé€™æ™‚å€™æ‡‰è©²æœƒå•å•é¡Œï¼šã€Œç‚ºä»€éº¼ position æ›´æ–°äº†ä½†æ˜¯`{content}`ä¸æœƒè¢«è§¸ç™¼æ›´æ–°ï¼Ÿä»–å€‘ä¸æ˜¯æ”¾åœ¨åŒå€‹ component è£¡å—ï¼Ÿã€ä½œè€…é€™æ™‚å€™æœƒèªªä½ å•çš„å•é¡Œå¾ˆæ£’ï¼Œä½†äº‹å¯¦ä¸¦ä¸æ˜¯ä½ æƒ³çš„é‚£æ¨£ã€‚å€‘å…ˆä¾†å®šç¾©ä»€éº¼æ˜¯ componentsã€ä»€éº¼æ˜¯ re-render?

ä»€éº¼æ˜¯ component? å…¶å¯¦å°±æ˜¯ä¸€å€‹ functionã€‚æ¯å€‹ component éƒ½æœƒ return ä¸€å€‹ React elementï¼ŒReact element æ˜¯ä¸€å€‹ç‰©ä»¶ï¼Œè£¡é¢åŒ…å«äº†é€™å€‹ component çš„è³‡è¨Šï¼Œä¾‹å¦‚ï¼štype, props, children ç­‰ç­‰ï¼ŒReact element æœƒè¢« React runtime è§£ææˆ DOM nodeï¼Œç„¶å¾Œ render åˆ°ç€è¦½å™¨ä¸Šã€‚ React.createElement è² è²¬å°‡ jsx èªæ³•ç³–è½‰æ›æˆ React çœ‹å¾—æ‡‚çš„ objectï¼Œå› ç‚ºæœ‰é»é›¢é¡Œï¼Œæˆ‘æŠŠ createElement çš„è§£é‡‹æ¬åˆ°æ–‡ç« æœ€å¾Œã€‚

é‡é»ä¾†äº†ï¼ŒReact æ€éº¼æ±ºå®šè¦ä¸è¦ re-renderï¼Ÿé‚„è¨˜å¾—å‰›å‰›è¢« createElement è½‰æˆçš„ç‰©ä»¶å—ï¼ŸReact æœƒç”¨ `Object.is(ElementBefore,ElementAfter)` å»æ¯”è¼ƒå·®ç•°ï¼Œå¦‚æœ return `true` é‚£éº¼å°±ä¸æœƒå» deep comparison å…©è€…çš„å·®ç•°;å¦‚æœ return `false` é‚£éº¼ React å°±æœƒå»å…ˆå»æ‰¾ç‰©ä»¶çš„ typeï¼Œå¦‚æœ type ç›¸åŒï¼ŒReact å°±æœƒä¾æ“š props å» re-render componentï¼Œå¦‚æœ type ä¸åŒï¼ŒReact å°±æœƒæŠŠèˆŠçš„ component å¾ DOM tree ä¸­ç§»é™¤ï¼Œç„¶å¾ŒæŠŠæ–°çš„ component render åˆ° DOM tree ä¸­ã€‚

åˆ°é€™é‚Šå°±è§£é‡‹å®Œç‚ºä»€éº¼ state æ›´æ–°äº†ä½†æ˜¯ component å»æ²’æœ‰ re-renderï¼Œæ­å–œä½ çš„ PR è¢«ä¸»ç®¡ approve äº†ï¼

### React.createElement è§£é‡‹

é€™é‚Šå€Ÿç”¨å®˜ç¶²çš„ç¯„ä¾‹ï¼Œä»–èªªæ˜äº†å¦‚æœä¸æƒ³ç”¨ jsx çš„è©±ï¼Œå¯ä»¥è‡ªè¡Œç”¨ React.createElement æ“ä½œï¼Œä¸Šè¿°æåˆ°çš„ jsx è½‰æˆ React element çš„éç¨‹å°±æ˜¯é€é React.createElement ä¾†å®Œæˆçš„ã€‚

````javascript

```javascript

```javascript
import { createElement } from 'react';

function Greeting({ name }) {
  return createElement(
    'h1',
    { className: 'greeting' },
    'Hello ',
    createElement('i', null, name),
    '. Welcome!'
  );
}
````

å…¶å¯¦ç›¸ç­‰æ–¼

```javascript
function Greeting({ name }) {
  return (
    <h1 className="greeting">
      Hello <i>{name}</i>. Welcome!
    </h1>
  );
}
```

## ä¸‹é›†å…§å®¹

ä¸‹ä¸€ç¯‡æ–‡ç« æœƒä»‹ç´¹ä¸€å€‹ React patternï¼š Children as propsï¼Œæ™‚è‡³ä»Šæ—¥é€™å€‹ pattern å¤§éƒ¨åˆ†å·²ç¶“è¢« React hooks å–ä»£ï¼Œä½†æ˜¯æœ‰äº›ç‰¹å®šæƒ…å¢ƒæœƒç”¨åˆ°ï¼ŒåŒæ™‚ä¹Ÿæœƒå¢åŠ ä½ å° React pattern çš„æ›´æ·±ä¸€å±¤èªè­˜ã€‚

## Reference:

    - [React dev createElement](https://react.dev/reference/react/createElement)
    - [ADVANCED REACT](https://advanced-react.com/)
